{"version":3,"sources":["../../src/Structures/ServerChannel.js"],"names":["ServerChannel","constructor","data","client","server","name","type","position","permissionOverwrites","permission_overwrites","forEach","permission","add","toObject","keys","obj","k","map","p","permissionsOf","userOrRole","internal","resolver","resolveUser","ownerID","id","everyoneRole","roles","get","userRoles","concat","rolesOf","userRolesID","filter","v","roleOverwrites","memberOverwrites","overwrite","push","indexOf","permissions","serverRole","deny","allow","resolveRole","permsOf","user","mention","toString","setName","setChannelName","apply","arguments","setPosition","setChannelPosition","update","updateChannel"],"mappings":"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","file":"ServerChannel.js","sourcesContent":["\"use strict\";\n\nimport Channel from \"./Channel\";\nimport Cache from \"../Util/Cache\";\nimport PermissionOverwrite from \"./PermissionOverwrite\";\nimport ChannelPermissions from \"./ChannelPermissions\";\nimport {reg} from \"../Util/ArgumentRegulariser\";\n\nexport default class ServerChannel extends Channel{\n\tconstructor(data, client, server){\n\t\tsuper(data, client);\n\t\tthis.name = data.name;\n\t\tthis.type = data.type;\n\t\tthis.position = data.position;\n\t\tthis.permissionOverwrites = data.permissionOverwrites || new Cache();\n\t\tthis.server = server;\n\t\tif (!data.permissionOverwrites) {\n\t\t\tdata.permission_overwrites.forEach((permission) => {\n\t\t\t\tthis.permissionOverwrites.add( new PermissionOverwrite(permission) );\n\t\t\t});\n\t\t}\n\t}\n\n\ttoObject() {\n\t\tlet keys = ['id', 'name', 'type', 'position'],\n\t\t\tobj = {};\n\n\t\tfor (let k of keys) {\n\t\t\tobj[k] = this[k];\n\t\t}\n\n\t\tobj.permissionOverwrites = this.permissionOverwrites.map(p => p.toObject());\n\n\t\treturn obj;\n\t}\n\n\tpermissionsOf(userOrRole){\n\t\tuserOrRole = this.client.internal.resolver.resolveUser(userOrRole);\n\t\tif (userOrRole) {\n\t\t\tif (this.server.ownerID === userOrRole.id) {\n\t\t\t\treturn new ChannelPermissions(4294967295);\n\t\t\t}\n\t\t\tvar everyoneRole = this.server.roles.get(\"id\", this.server.id);\n\n\t\t\tvar userRoles = [everyoneRole].concat(this.server.rolesOf(userOrRole) || []);\n\t\t\tvar userRolesID = userRoles.filter((v) => !!v).map((v) => v.id);\n\t\t\tvar roleOverwrites = [], memberOverwrites = [];\n\n\t\t\tthis.permissionOverwrites.forEach((overwrite) => {\n\t\t\t\tif (overwrite.type === \"member\" && overwrite.id === userOrRole.id) {\n\t\t\t\t\tmemberOverwrites.push(overwrite);\n\t\t\t\t} else if (overwrite.type === \"role\" && ~userRolesID.indexOf(overwrite.id)) {\n\t\t\t\t\troleOverwrites.push(overwrite);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tvar permissions = 0;\n\n\t\t\tfor(var serverRole of userRoles){\n\t\t\t\tif (serverRole) {\n\t\t\t\t\tpermissions |= serverRole.permissions;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor(var overwrite of roleOverwrites.concat(memberOverwrites)){\n\t\t\t\tif (overwrite) {\n\t\t\t\t\tpermissions = permissions & ~overwrite.deny;\n\t\t\t\t\tpermissions = permissions | overwrite.allow;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn new ChannelPermissions(permissions);\n\n\t\t} else {\n\t\t\tuserOrRole = this.client.internal.resolver.resolveRole(userOrRole);\n\t\t\tif (userOrRole) {\n\t\t\t\tvar permissions = this.server.roles.get(\"id\", this.server.id).permissions | userOrRole.permissions;\n\t\t\t\tvar overwrite = this.permissionOverwrites.get(\"id\", this.server.id);\n\t\t\t\tpermissions = (permissions & ~overwrite.deny) | overwrite.allow;\n\t\t\t\toverwrite = this.permissionOverwrites.get(\"id\", userOrRole.id);\n\t\t\t\tif (overwrite) {\n\t\t\t\t\tpermissions = (permissions & ~overwrite.deny) | overwrite.allow;\n\t\t\t\t}\n\t\t\t\treturn new ChannelPermissions(permissions);\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t}\n\n\tpermsOf(user){\n\t\treturn this.permissionsOf(user);\n\t}\n\n\tmention(){\n\t\treturn `<#${this.id}>`;\n\t}\n\n\ttoString(){\n\t\treturn this.mention();\n\t}\n\n\tsetName(){\n\t\treturn this.client.setChannelName.apply(this.client, reg(this, arguments));\n\t}\n\n\tsetPosition(){\n\t\treturn this.client.setChannelPosition.apply(this.client, reg(this, arguments));\n\t}\n\n\tupdate(){\n\t\treturn this.client.updateChannel.apply(this.client, reg(this, arguments));\n\t}\n}\n"]}